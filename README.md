# PROJECT README
## About the project

Написати мікросервіс, використовуючи framework Laravel:
1. Який щогодини зберігає температуру по одному місту, наприклад по Києву (вказується в env).
   Як варіант можна використовувати цей API: https://openweathermap.org/api.
2. По API віддає історію температури за день (який задаємо):
- day – GET-параметрі у форматі Y-m-d;
- x-token - рядок 32 символу передається через хедер (це просто константа, на яку треба перевірити запит, щоб відсіяти спам);
- формат повернення для всіх відповідей (у тому числі помилки) у форматі JSON;
- докеризувати проект

### Пояснювальна записка

пыд час першого запуску проекту буде виконано команду composer install --optimize-autoloader. Тож проект буде доступний лише після завершення команди. 

Проект призначений для збереження температури за вказаним в енв файлі містом. Щогодини запускається крон задача яка виконує запит до вказаного в конфігуріції провайдера погоди
і зберігає отримані данні в базі даних. В подальшому отримати збережені дані можна через АПІ ендпоінт який поверне колекцію обєктів 
де буде вказано місто, температура та юніти вимірювання.

Також для примусового отримання даних доступна Artisan команда яку можна викликати в середовищі виконання weather:retrieve (Artisan команди доступні лише всередені середовища. Як туди потрапити описано в дозілі [Console](./guides/console.md)).
  ```bash
  php artisan weather:retrieve
  ```

Доступні .env параметри

  | Параметр                | Доступні варінти                      | Опис                                                                                                                                                                                                  | Приклад                                 |
  |-------------------------|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
  | OPENWEATHER_MAP_UNITS   | metric,imperial                       | Цим параметром можна вказати яка система вимірювань буде використовуватись для збереження даних                                                                                                       | OPENWEATHER_MAP_UNITS=imperial          |
  | WEATHER_FAILSAFE_MODE   | true,false                            | Цей параметр описує поведінку сервіса в разі помилки отримання даних. Якщо параметр true, то у випадку помилки буде виконана спроба отримати дані з першого ліпшого дата провайдера якщо їх декілька. | WEATHER_FAILSAFE_MODE=true              |
  | WEATHER_CITY_TARGET     |                                       | Цим паравметром ми вказуэмо наше цільове місто за яким хочемо вести моніторинг. Формат: city_name,state_code,country_name.                                                                            | WEATHER_CITY_TARGET=Kyiv,,Ukraine       |
  | WEATHER_DEFAULT_DRIVER  | openweathermap,accuweather,weatherapi | Цим параметром можна вказати дата провайдер для отримання даних температури. В разі необхідності можна імплементувати свій дравер для отримання даних з інших ресурсів.                               | WEATHER_DEFAULT_DRIVER=openweathermap   |
  | OPENWEATHER_MAP_API_KEY |                                       | Апі ключ для доступу до апі провайдера (в рамках цього проекту я опускаю безпекові переживання і надаю ключі в .env.example)                                                                          | OPENWEATHER_MAP_API_KEY=123123123123123 |
  | ACCUWEATHER_API_KEY     |                                       | Апі ключ для доступу до апі провайдера (в рамках цього проекту я опускаю безпекові переживання і надаю ключі в .env.example)                                                                          | ACCUWEATHER_API_KEY=123123123123123     |

Допущення:
 - авторизація в рамках цього проекту це суто умовна штука. Наразі реалізовано отримання токена в якості реєстрації і перевірка токена в якості авторизації. Спрощено по максимуму.
 - архітектурна реалізація фонового виконаяння задач і шедулера не є принциповою. Тому крон - це баш скрипт cron.sh, а в якості дравера черг використаний sync.
 - документація до апі може бути оформлена будь яким чином(Swagger, JsonAPI, окрема WEB строрінка).
 - тести пасувало б написати, але захопився і не залишив собі часу на них(((
 - проект невеликий, тому один коміт

## Requirements
* [git](https://git-scm.com/)
* [make (3.81 or later)](https://savannah.gnu.org/projects/make/)
* [docker (19.03.12 or later)](https://docs.docker.com/engine/install/)
* [docker-compose (2.28.0 or later)](https://docs.docker.com/compose/install/)

## Install

### 1. Clone the repo
```bash
git clone git@github.com:mtereschenko/weather_app.git
```

## Usage
* [Console](./guides/console.md)
